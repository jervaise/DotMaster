# DotMaster v2.2.4 Patch Notes
*Released: January 27, 2025*

## 🛡️ Major Threat System Improvements

### **Multi-Tank Raid Support**
Fixed a critical issue where the Force Threat function didn't properly consider other tanks in raid environments. Tank players will now see accurate threat feedback when multiple tanks are present.

#### **What Changed:**
- **Before**: Force Threat would show "no aggro" warning even when another tank was legitimately tanking the unit
- **After**: System now checks if another tank in the raid is handling the unit before showing warnings

#### **Technical Details:**
- Added `Plater.ZoneInstanceType == "raid"` detection
- Integrated `Plater.GetTanks()` to identify all tanks in the group
- Enhanced `UnitName(unitFrame.targetUnitID)` validation for target checking

### **Enhanced Combat Logic**
Improved the overall threat detection accuracy with better state validation:

- **Combat State Checks**: Only processes threat when player and unit are in combat
- **PVP Protection**: Automatically disables threat coloring in PVP environments  
- **Unit Validation**: Ensures proper unit existence and combat state before processing

## 🔧 Technical Updates

### **Force Threat Function Rewrite**
Both "Nameplate Updated" and "Nameplate Added" hooks received comprehensive updates:

```lua
-- New logic flow:
1. Check if player is in combat
2. Check if unit is in combat  
3. Check if unit is player-controlled (PVP)
4. For tanks not tanking:
   - If in raid: Check if another tank is tanking
   - If not in raid: Show no-aggro immediately
5. For DPS/Healers: Show aggro warning if tanking
```

### **Performance Improvements**
- **Reduced False Positives**: Eliminates unnecessary threat warnings in multi-tank scenarios
- **Efficient Checking**: Optimized tank list validation
- **State Management**: Better handling of threat state transitions

## 🎯 User Experience

### **For Tank Players**
- **Accurate Warnings**: Only get "no aggro" alerts when genuinely needed
- **Raid Awareness**: System understands when other tanks are handling units
- **Quick Response**: Maintains fast threat detection for solo tank situations

### **For DPS/Healers**  
- **Consistent Behavior**: Aggro warnings work the same in all group types
- **Clear Feedback**: Reliable indication when pulling threat from tanks

## 🚀 Compatibility

### **WoW Version Support**
- **11.2.*** (The War Within Season 3) - Full Support ✅
- **11.1.7+** (Current Live) - Maintained Support ✅
- **Interface Version**: Updated to 110200

### **Plater Integration**
- **Modern Standards**: Updated to match current Plater scripting best practices
- **Hook Compatibility**: Enhanced integration with Plater's threat system
- **Performance**: Minimal impact on nameplate update performance

## 📋 Known Issues Resolved

### **Fixed Issues:**
- ✅ Force Threat showing false "no aggro" warnings in raids when another tank was tanking
- ✅ Threat coloring activating inappropriately in PVP environments
- ✅ Threat detection running when player or unit not in combat

### **Remaining Considerations:**
- Force Threat function requires Plater's tank detection to be properly configured
- Multi-tank scenarios rely on accurate group role detection

## 📥 Upgrade Instructions

1. **Download** DotMaster 2.2.4 from your preferred addon manager
2. **Restart** World of Warcraft to ensure proper loading
3. **Test** Force Threat function in both raid and dungeon environments
4. **Verify** that threat warnings now behave appropriately with multiple tanks

## 🔄 Migration Notes

- **Settings Preserved**: All existing DotMaster settings carry over automatically
- **No Configuration Required**: Threat improvements are automatically active
- **Plater Integration**: May need to refresh Plater integration via DotMaster settings

---

*This patch addresses one of the most frequently reported issues with DotMaster's threat detection system. Tank players should now experience much more reliable and contextually appropriate threat feedback in all group scenarios.* 